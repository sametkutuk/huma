<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¨ HUMA - Alfabe Ã–ÄŸreniyorum</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 32px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2rem;
            color: #FF6B6B;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-btn {
            background: #4ECDC4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .settings-btn:hover {
            background: #45b8b0;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .letter-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .letter-card {
            aspect-ratio: 0.85;
            background: white;
            border: 3px solid #7B68EE;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px 10px;
            position: relative;
            overflow: visible;
        }

        .letter-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
            border-color: #6A5ACD;
        }

        .letter-card:active {
            transform: translateY(-4px) scale(0.98);
        }

        .letter-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .letter-uppercase {
            font-size: 3rem;
            font-weight: 900;
            line-height: 1;
            color: #7B68EE;
            text-shadow: none;
        }

        .letter-lowercase {
            font-size: 1.3rem;
            font-weight: 600;
            color: #9B8FD9;
        }

        .letter-icon {
            position: absolute;
            bottom: -35px;
            right: -15px;
            width: 100px;
            height: 100px;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 10;
        }

        .letter-card:hover .letter-icon {
            opacity: 1;
            bottom: -45px;
        }

        .letter-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.3));
        }

        .letter-icon div {
            font-size: 4rem !important;
            filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.3));
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 50px;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 20px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.8rem;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section h3 {
            color: #FF6B6B;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #FFE66D;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2C3E50;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4ECDC4;
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.85rem;
        }

        .prompts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .prompt-group {
            position: relative;
        }

        .prompt-group label {
            font-weight: 600;
            color: #2C3E50;
            font-size: 1.1rem;
            display: block;
            margin-bottom: 5px;
        }

        .prompt-group input {
            width: 100%;
            padding: 10px 40px 10px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .prompt-group input:focus {
            border-color: #4ECDC4;
        }

        .prompt-group.has-custom input {
            border-color: #FF6B6B;
            background: #fff9f9;
        }

        .reset-btn {
            position: absolute;
            right: 5px;
            top: 32px;
            background: #FFE66D;
            border: none;
            color: #2C3E50;
            font-size: 1.2rem;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reset-btn:hover:not(:disabled) {
            background: #ffd93d;
            transform: rotate(180deg);
        }

        .reset-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .save-btn {
            background: #4ECDC4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .save-btn:hover {
            background: #45b8b0;
            transform: translateY(-2px);
        }

        .info-box {
            background: #E3F2FD;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .info-box p {
            margin: 5px 0;
            color: #1976D2;
            font-size: 0.95rem;
        }

        .warning-box {
            background: #FFF9C4;
            border-left: 4px solid #FFC107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .warning-box p {
            margin: 5px 0;
            color: #F57C00;
            font-size: 0.95rem;
        }

        .usage-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .stat-item {
            flex: 1;
            background: white;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2C3E50;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }

        /* Animations */
        @keyframes bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            25% { transform: translateY(-20px) scale(1.1); }
            50% { transform: translateY(-10px) scale(1.05); }
            75% { transform: translateY(-15px) scale(1.08); }
        }

        .animate-bounce {
            animation: bounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .letter-grid {
                grid-template-columns: repeat(7, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .letter-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 10px;
            }

            .letter-uppercase {
                font-size: 2.2rem;
            }

            .letter-lowercase {
                font-size: 1.1rem;
            }

            .letter-card {
                padding: 10px 5px;
            }

            .prompts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .letter-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
            }

            .letter-uppercase {
                font-size: 1.8rem;
            }

            .letter-lowercase {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>ğŸ¨ HUMA - Alfabe Ã–ÄŸreniyorum</h1>
            <button class="settings-btn" onclick="openSettings()">âš™ï¸ Ayarlar</button>
        </div>
        <div class="letter-grid" id="letterGrid"></div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ Ayarlar</h2>
                <button class="close-btn" onclick="closeSettings()">âœ•</button>
            </div>
            <div class="modal-body">
                <!-- Tema SeÃ§imi -->
                <div class="settings-section">
                    <h3>ğŸ¨ Tema SeÃ§imi</h3>
                    <div class="form-group">
                        <label for="themeSelect">Ã–ÄŸrenme TemasÄ±:</label>
                        <select id="themeSelect" onchange="changeTheme()">
                            <option value="alfabe">Alfabe</option>
                            <option value="ciftlik">Ã‡iftlik HayvanlarÄ±</option>
                            <option value="ev">Ev EÅŸyalarÄ±</option>
                        </select>
                        <small>Tema seÃ§imi tÃ¼m harflerin aÃ§Ä±klamalarÄ±nÄ± deÄŸiÅŸtirir.</small>
                    </div>
                </div>

                <!-- Google TTS API -->
                <div class="settings-section">
                    <h3>ğŸ”‘ Google Cloud API Key</h3>
                    <p style="color: #666; margin-bottom: 15px;">KÃ¼Ã§Ã¼k kÄ±z sesi iÃ§in Google Cloud Text-to-Speech API key'inizi girin.</p>
                    <div class="form-group">
                        <label for="apiKey">API Key:</label>
                        <input type="password" id="apiKey" placeholder="AIza..." value="">
                        <button class="save-btn" onclick="saveApiKey()">ğŸ’¾ API Key Kaydet</button>
                    </div>
                    
                    <div class="info-box">
                        <p>ğŸ’° <strong>Ãœcretsiz Kota:</strong> Ayda 1 milyon karakter Ã¼cretsiz!</p>
                        <p>ğŸ“Š <strong>Cache:</strong> <span id="cacheCount">0</span> ses kaydedildi (tekrar API kullanmaz)</p>
                        <p>ğŸ”— <strong>KullanÄ±mÄ± takip et:</strong> <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a></p>
                    </div>
                </div>

                <!-- KullanÄ±m Limiti -->
                <div class="settings-section">
                    <h3>ğŸ“Š KullanÄ±m Limiti</h3>
                    <p style="color: #666; margin-bottom: 15px;">API kullanÄ±mÄ±nÄ± sÄ±nÄ±rlandÄ±rarak maliyeti kontrol edin.</p>
                    
                    <div class="usage-stats">
                        <div class="stat-item">
                            <div class="stat-label">ğŸ“ˆ Toplam KullanÄ±m (TÃ¼m Zamanlar):</div>
                            <div class="stat-value"><span id="totalUsage">0</span> karakter</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ğŸ“ Mevcut Limit:</div>
                            <div class="stat-value"><span id="currentLimit">90</span> karakter</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ğŸ¯ Kalan Kota:</div>
                            <div class="stat-value"><span id="remainingQuota">90</span> karakter</div>
                        </div>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="unlimitedUsage" onchange="toggleUnlimited()">
                        <label for="unlimitedUsage">â™¾ï¸ SÄ±nÄ±rsÄ±z KullanÄ±m (Limit yok)</label>
                    </div>

                    <div class="form-group" id="limitGroup">
                        <label for="maxLimit">Maksimum Karakter Limiti:</label>
                        <input type="number" id="maxLimit" value="90" min="10" max="10000" onchange="saveLimit()">
                        <small>ğŸ’¡ Ä°pucu: Toplam kullanÄ±m en baÅŸÄ±ndan itibaren tÃ¼m API Ã§aÄŸrÄ±larÄ±nÄ± gÃ¶sterir. Cache'deki sesler limiti etkilemez.</small>
                    </div>

                    <button class="save-btn" onclick="saveLimit()">ğŸ’¾ Limiti Kaydet</button>
                </div>

                <!-- Ses Motoru -->
                <div class="settings-section">
                    <h3>ğŸ™ï¸ Ses Motoru</h3>
                    <div class="form-group">
                        <label for="ttsEngine">Ses Motoru SeÃ§imi:</label>
                        <select id="ttsEngine" onchange="saveTtsEngine()">
                            <option value="browser">TarayÄ±cÄ± (Web Speech API - Ãœcretsiz)</option>
                            <option value="google">Google Cloud TTS (API Key gerekli)</option>
                        </select>
                        <small>Google TTS iÃ§in yukarÄ±dan API key girmeniz gerekir.</small>
                    </div>
                </div>

                <!-- Ses AyarlarÄ± -->
                <div class="settings-section">
                    <h3>ğŸ”Š Ses AyarlarÄ±</h3>
                    <div class="form-group" id="googleVoiceGroup" style="display: none;">
                        <label for="googleVoiceSelect">Google Ses SeÃ§imi:</label>
                        <select id="googleVoiceSelect" onchange="saveGoogleVoice()">
                            <option value="tr-TR-Wavenet-A">tr-TR-Wavenet-A (KadÄ±n)</option>
                            <option value="tr-TR-Wavenet-B">tr-TR-Wavenet-B (Erkek)</option>
                            <option value="tr-TR-Wavenet-C">tr-TR-Wavenet-C (KadÄ±n)</option>
                            <option value="tr-TR-Wavenet-D">tr-TR-Wavenet-D (KadÄ±n)</option>
                            <option value="tr-TR-Wavenet-E">tr-TR-Wavenet-E (Erkek)</option>
                            <option value="tr-TR-Standard-A">tr-TR-Standard-A (KadÄ±n)</option>
                            <option value="tr-TR-Standard-B">tr-TR-Standard-B (Erkek)</option>
                            <option value="tr-TR-Standard-C">tr-TR-Standard-C (KadÄ±n)</option>
                            <option value="tr-TR-Standard-D">tr-TR-Standard-D (KadÄ±n)</option>
                            <option value="tr-TR-Standard-E">tr-TR-Standard-E (Erkek)</option>
                        </select>
                        <small>YÃ¼ksek kaliteli TÃ¼rkÃ§e sesler.</small>
                    </div>
                    <div class="form-group" id="browserVoiceGroup">
                        <label for="voiceSelect">TarayÄ±cÄ± Ses SeÃ§imi:</label>
                        <select id="voiceSelect" onchange="saveVoice()">
                            <option value="">VarsayÄ±lan</option>
                        </select>
                        <small>TarayÄ±cÄ± ses seÃ§enekleri.</small>
                    </div>

                    <div class="form-group">
                        <label for="speechRate">KonuÅŸma HÄ±zÄ±: <span id="rateValue">0.75</span></label>
                        <input type="range" id="speechRate" min="0.5" max="2" step="0.05" value="0.75" 
                               oninput="updateRate(this.value)" style="width: 100%;">
                        <small>ğŸ¢ YavaÅŸ (0.5-0.8) | ğŸš¶ Normal (0.9-1.1) | ğŸƒ HÄ±zlÄ± (1.2+) - Ã‡ocuklar iÃ§in yavaÅŸ Ã¶nerilir</small>
                    </div>
                    <div class="form-group">
                        <label for="speechPitch">Ses Tonu: <span id="pitchValue">1.5</span></label>
                        <input type="range" id="speechPitch" min="0.5" max="2" step="0.1" value="1.5" 
                               oninput="updatePitch(this.value)" style="width: 100%;">
                        <small>ğŸµ AlÃ§ak (0.5-0.9) | ğŸ¶ Normal (1.0-1.2) | ğŸ¤ YÃ¼ksek/TatlÄ± (1.3+) - Ã‡ocuklar iÃ§in yÃ¼ksek Ã¶nerilir</small>
                    </div>

                </div>

                <!-- Ã–zel AÃ§Ä±klamalar -->
                <div class="settings-section">
                    <h3>âœï¸ Ã–zel AÃ§Ä±klamalar</h3>
                    <p style="color: #666; margin-bottom: 15px;">Her harf iÃ§in Ã¶zel aÃ§Ä±klama girebilirsiniz.</p>
                    <div class="prompts-grid" id="promptsGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // TÃ¼rkÃ§e Alfabe
        const TURKISH_LETTERS = [
            'A', 'B', 'C', 'Ã‡', 'D', 'E', 'F', 'G', 'Ä', 'H',
            'I', 'Ä°', 'J', 'K', 'L', 'M', 'N', 'O', 'Ã–', 'P',
            'R', 'S', 'Å', 'T', 'U', 'Ãœ', 'V', 'Y', 'Z'
        ];

        // Temalar
        const THEMES = {

            alfabe: {
                'A': 'A harfi Annenin A\'sÄ±', 'B': 'B harfi BabanÄ±n B\'si', 'C': 'C harfi Ceylinin C\'si',
                'Ã‡': 'Ã‡ harfi Ã‡iÃ§eÄŸin Ã‡\'si', 'D': 'D harfi Dedenin D\'si', 'E': 'E harfi Evin E\'si',
                'F': 'F harfi FÄ±stÄ±ÄŸÄ±n F\'sÄ±', 'G': 'G harfi GÃ¼neÅŸin G\'si', 'Ä': 'Ä harfi DaÄŸÄ±n Ä\'sÄ±',
                'H': 'H harfi HalanÄ±n H\'sÄ±', 'I': 'I harfi IrmaÄŸÄ±n I\'sÄ±', 'Ä°': 'Ä° harfi Ä°pliÄŸin Ä°\'si',
                'J': 'J harfi JimnastiÄŸin J\'si', 'K': 'K harfi Kalemin K\'sÄ±', 'L': 'L harfi LambanÄ±n L\'si',
                'M': 'M harfi Meyvenin M\'si', 'N': 'N harfi Nenenin N\'si', 'O': 'O harfi Okumun O\'su',
                'Ã–': 'Ã– harfi Ã–ÄŸretmenin Ã–\'sÃ¼', 'P': 'P harfi PastanÄ±n P\'si', 'R': 'R harfi Resminin R\'si',
                'S': 'S harfi Saatin S\'sÄ±', 'Å': 'Å harfi ÅapkanÄ±n Å\'sÄ±', 'T': 'T harfi Topun T\'sÄ±',
                'U': 'U harfi UÃ§aÄŸÄ±n U\'su', 'Ãœ': 'Ãœ harfi ÃœtÃ¼nÃ¼n Ãœ\'sÃ¼', 'V': 'V harfi Vazonun V\'sÄ±',
                'Y': 'Y harfi YataÄŸÄ±n Y\'sÄ±', 'Z': 'Z harfi Zeytinin Z\'si'
            },
            ciftlik: {
                'A': 'A harfi AtÄ±n A\'sÄ±', 'B': 'B harfi BuzaÄŸÄ±nÄ±n B\'si', 'C': 'C harfi CivcivÄ±n C\'si',
                'Ã‡': 'Ã‡ harfi Ã‡obanÄ±n Ã‡\'si', 'D': 'D harfi DanayÄ±n D\'si', 'E': 'E harfi EÅŸeÄŸin E\'si',
                'F': 'F harfi Farenin F\'si', 'G': 'G harfi GÃ¼vercinin G\'si', 'Ä': 'Ä harfi AÄŸÄ±lÄ±n Ä\'sÄ±',
                'H': 'H harfi Horozun H\'sÄ±', 'I': 'I harfi KÄ±rlangÄ±cÄ±n I\'sÄ±', 'Ä°': 'Ä° harfi Ä°neÄŸin Ä°\'si',
                'J': 'J harfi JokeyÄ±n J\'si', 'K': 'K harfi Koyunun K\'sÄ±', 'L': 'L harfi Leylek\'in L\'si',
                'M': 'M harfi MandanÄ±n M\'si', 'N': 'N harfi Nenenin N\'si', 'O': 'O harfi Ordek\'in O\'su',
                'Ã–': 'Ã– harfi Ã–kÃ¼zÃ¼n Ã–\'sÃ¼', 'P': 'P harfi PelikannÄ±n P\'si', 'R': 'R harfi ReyhanÄ±n R\'si',
                'S': 'S harfi SÄ±ÄŸÄ±rÄ±n S\'sÄ±', 'Å': 'Å harfi ÅahinÄ±n Å\'sÄ±', 'T': 'T harfi TavuÄŸun T\'sÄ±',
                'U': 'U harfi UÄŸurbÃ¶ceÄŸinin U\'su', 'Ãœ': 'Ãœ harfi ÃœlkÃ¼nÃ¼n Ãœ\'sÃ¼', 'V': 'V harfi VaranÄ±n V\'sÄ±',
                'Y': 'Y harfi YÄ±lanÄ±n Y\'sÄ±', 'Z': 'Z harfi ZÃ¼rafa\'nÄ±n Z\'si'
            },

            ev: {
                'A': 'A harfi AynanÄ±n A\'sÄ±', 'B': 'B harfi BardaÄŸÄ±n B\'si', 'C': 'C harfi CamÄ±n C\'si',
                'Ã‡': 'Ã‡ harfi Ã‡atalÄ±n Ã‡\'si', 'D': 'D harfi DolabÄ±n D\'si', 'E': 'E harfi ElektriÄŸin E\'si',
                'F': 'F harfi FÄ±rÄ±nÄ±n F\'sÄ±', 'G': 'G harfi GÃ¶zlÃ¼ÄŸÃ¼n G\'sÃ¼', 'Ä': 'Ä harfi YaÄŸÄ±n Ä\'sÄ±',
                'H': 'H harfi HalÄ±nÄ±n H\'sÄ±', 'I': 'I harfi IÅŸÄ±ÄŸÄ±n I\'sÄ±', 'Ä°': 'Ä° harfi Ä°ÄŸnenin Ä°\'si',
                'J': 'J harfi JiletÄ±n J\'si', 'K': 'K harfi KapÄ±nÄ±n K\'sÄ±', 'L': 'L harfi LambanÄ±n L\'si',
                'M': 'M harfi MasanÄ±n M\'si', 'N': 'N harfi NiÅŸastanÄ±n N\'si', 'O': 'O harfi OdanÄ±n O\'su',
                'Ã–': 'Ã– harfi Ã–rtÃ¼nÃ¼n Ã–\'sÃ¼', 'P': 'P harfi Perdenin P\'si', 'R': 'R harfi RafÄ±n R\'si',
                'S': 'S harfi Sandalyenin S\'sÄ±', 'Å': 'Å harfi Åemsiyenin Å\'sÄ±', 'T': 'T harfi TabaÄŸÄ±n T\'sÄ±',
                'U': 'U harfi ÃœtÃ¼nÃ¼n U\'su', 'Ãœ': 'Ãœ harfi ÃœtÃ¼ masasÄ±nÄ±n Ãœ\'sÃ¼', 'V': 'V harfi Vazonun V\'sÄ±',
                'Y': 'Y harfi YastÄ±ÄŸÄ±n Y\'sÄ±', 'Z': 'Z harfi Zilin Z\'si'
            }
        };

        // Lowercase mapping
        const LOWERCASE = {
            'A': 'a', 'B': 'b', 'C': 'c', 'Ã‡': 'Ã§', 'D': 'd', 'E': 'e', 'F': 'f', 'G': 'g', 'Ä': 'ÄŸ',
            'H': 'h', 'I': 'Ä±', 'Ä°': 'i', 'J': 'j', 'K': 'k', 'L': 'l', 'M': 'm', 'N': 'n', 'O': 'o',
            'Ã–': 'Ã¶', 'P': 'p', 'R': 'r', 'S': 's', 'Å': 'ÅŸ', 'T': 't', 'U': 'u', 'Ãœ': 'Ã¼', 'V': 'v',
            'Y': 'y', 'Z': 'z'
        };

        // Theme images (emoji fallback for now, can be replaced with actual images)
        const THEME_IMAGES = {
            alfabe: {
                'A': 'ğŸ‘©', 'B': 'ğŸ‘¨', 'C': 'ğŸ‘§', 'Ã‡': 'ğŸŒ¸', 'D': 'ğŸ‘´', 'E': 'ğŸ ', 'F': 'ğŸ¥œ', 'G': 'â˜€ï¸', 'Ä': 'â›°ï¸',
                'H': 'ğŸ‘©â€ğŸ¦°', 'I': 'ğŸï¸', 'Ä°': 'ğŸ§µ', 'J': 'ğŸ¤¸', 'K': 'âœï¸', 'L': 'ğŸ’¡', 'M': 'ğŸ', 'N': 'ğŸ‘µ', 'O': 'ğŸ¹',
                'Ã–': 'ğŸ‘¨â€ğŸ«', 'P': 'ğŸ°', 'R': 'ğŸ¨', 'S': 'â°', 'Å': 'ğŸ©', 'T': 'âš½', 'U': 'âœˆï¸', 'Ãœ': 'ğŸ”Œ', 'V': 'ğŸº',
                'Y': 'ğŸ›ï¸', 'Z': 'ğŸ«’'
            },
            ciftlik: {
                'A': 'ğŸ´', 'B': 'ğŸ„', 'C': 'ğŸ£', 'Ã‡': 'ğŸ‘¨â€ğŸŒ¾', 'D': 'ğŸ®', 'E': 'ğŸ«', 'F': 'ğŸ­', 'G': 'ğŸ•Šï¸', 'Ä': 'ğŸšï¸',
                'H': 'ğŸ“', 'I': 'ğŸ¦', 'Ä°': 'ğŸ„', 'J': 'ğŸ‡', 'K': 'ğŸ‘', 'L': 'ğŸ¦©', 'M': 'ğŸ¦¬', 'N': 'ğŸ”', 'O': 'ğŸ¦†',
                'Ã–': 'ğŸ‚', 'P': 'ğŸ¦œ', 'R': 'ğŸŒ¿', 'S': 'ğŸ„', 'Å': 'ğŸ¦…', 'T': 'ğŸ”', 'U': 'ğŸ', 'Ãœ': 'ğŸ¦‹', 'V': 'ğŸ¦',
                'Y': 'ğŸ', 'Z': 'ğŸ¦’'
            },
            ev: {
                'A': 'ğŸª', 'B': 'ğŸ¥¤', 'C': 'ğŸªŸ', 'Ã‡': 'ğŸ´', 'D': 'ğŸ—„ï¸', 'E': 'ğŸ’¡', 'F': 'ğŸ”¥', 'G': 'ğŸ‘“', 'Ä': 'ğŸ§ˆ',
                'H': 'ğŸ§º', 'I': 'ğŸ’¡', 'Ä°': 'ğŸª¡', 'J': 'ğŸª’', 'K': 'ğŸšª', 'L': 'ğŸ•¯ï¸', 'M': 'ğŸª‘', 'N': 'ğŸ§º', 'O': 'ğŸšª',
                'Ã–': 'ğŸ§£', 'P': 'ğŸªŸ', 'R': 'ğŸ“š', 'S': 'ğŸª‘', 'Å': 'â˜‚ï¸', 'T': 'ğŸ½ï¸', 'U': 'ğŸ”Œ', 'Ãœ': 'ğŸ§º', 'V': 'ğŸº',
                'Y': 'ğŸ›ï¸', 'Z': 'ğŸ””'
            }
        };

        // Kelime-Emoji eÅŸleÅŸtirme sÃ¶zlÃ¼ÄŸÃ¼
        const WORD_TO_EMOJI = {
            // Hayvanlar
            'at': 'ğŸ´', 'atÄ±n': 'ğŸ´', 'inek': 'ğŸ„', 'ineÄŸin': 'ğŸ„', 'buzaÄŸÄ±': 'ğŸ„', 'buzaÄŸÄ±nÄ±n': 'ğŸ„',
            'civciv': 'ğŸ£', 'civcivÄ±n': 'ğŸ£', 'Ã§oban': 'ğŸ‘¨â€ğŸŒ¾', 'Ã§obanÄ±n': 'ğŸ‘¨â€ğŸŒ¾', 'dana': 'ğŸ®', 'danayÄ±n': 'ğŸ®',
            'eÅŸek': 'ğŸ«', 'eÅŸeÄŸin': 'ğŸ«', 'fare': 'ğŸ­', 'farenin': 'ğŸ­', 'gÃ¼vercin': 'ğŸ•Šï¸', 'gÃ¼vercinin': 'ğŸ•Šï¸',
            'aÄŸÄ±l': 'ğŸšï¸', 'aÄŸÄ±lÄ±n': 'ğŸšï¸', 'horoz': 'ğŸ“', 'horozun': 'ğŸ“', 'kÄ±rlangÄ±Ã§': 'ğŸ¦', 'kÄ±rlangÄ±cÄ±n': 'ğŸ¦',
            'jokey': 'ğŸ‡', 'jokeyÄ±n': 'ğŸ‡', 'koyun': 'ğŸ‘', 'koyunun': 'ğŸ‘', 'leylek': 'ğŸ¦©', 'leylek\'in': 'ğŸ¦©',
            'manda': 'ğŸ¦¬', 'mandanÄ±n': 'ğŸ¦¬', 'maymun': 'ğŸµ', 'maymunun': 'ğŸµ', 'nene': 'ğŸ”', 'nenenin': 'ğŸ”',
            'Ã¶rdek': 'ğŸ¦†', 'Ã¶rdeÄŸin': 'ğŸ¦†', 'ordek': 'ğŸ¦†', 'ordek\'in': 'ğŸ¦†', 'ordeÄŸin': 'ğŸ¦†', 'Ã¶redeÄŸin': 'ğŸ¦†',
            'Ã¶kÃ¼z': 'ğŸ‚', 'Ã¶kÃ¼zÃ¼n': 'ğŸ‚', 'pelikan': 'ğŸ¦œ', 'pelikannÄ±n': 'ğŸ¦œ',
            'reyhan': 'ğŸŒ¿', 'reyhanÄ±n': 'ğŸŒ¿', 'sÄ±ÄŸÄ±r': 'ğŸ„', 'sÄ±ÄŸÄ±rÄ±n': 'ğŸ„', 'ÅŸahin': 'ğŸ¦…', 'ÅŸahinÄ±n': 'ğŸ¦…',
            'tavuk': 'ğŸ”', 'tavuÄŸun': 'ğŸ”', 'uÄŸurbÃ¶ceÄŸi': 'ğŸ', 'uÄŸurbÃ¶ceÄŸinin': 'ğŸ', 'Ã¼lkÃ¼': 'ğŸ¦‹', 'Ã¼lkÃ¼nÃ¼n': 'ğŸ¦‹',
            'varan': 'ğŸ¦', 'varanÄ±n': 'ğŸ¦', 'yÄ±lan': 'ğŸ', 'yÄ±lanÄ±n': 'ğŸ', 'zÃ¼rafa': 'ğŸ¦’', 'zÃ¼rafa\'nÄ±n': 'ğŸ¦’',
            'kedi': 'ğŸ±', 'kedinin': 'ğŸ±', 'kÃ¶pek': 'ğŸ¶', 'kÃ¶peÄŸin': 'ğŸ¶', 'kuÅŸ': 'ğŸ¦', 'kuÅŸun': 'ğŸ¦',
            'balÄ±k': 'ğŸŸ', 'balÄ±ÄŸÄ±n': 'ğŸŸ', 'kelebek': 'ğŸ¦‹', 'kelebeÄŸin': 'ğŸ¦‹', 'arÄ±': 'ğŸ', 'arÄ±nÄ±n': 'ğŸ',
            
            // Ev EÅŸyalarÄ±
            'ayna': 'ğŸª', 'aynanÄ±n': 'ğŸª', 'bardak': 'ğŸ¥¤', 'bardaÄŸÄ±n': 'ğŸ¥¤', 'cam': 'ğŸªŸ', 'camÄ±n': 'ğŸªŸ',
            'Ã§atal': 'ğŸ´', 'Ã§atalÄ±n': 'ğŸ´', 'dolap': 'ğŸ—„ï¸', 'dolabÄ±n': 'ğŸ—„ï¸', 'elektrik': 'ğŸ’¡', 'elektriÄŸin': 'ğŸ’¡',
            'fÄ±rÄ±n': 'ğŸ”¥', 'fÄ±rÄ±nÄ±n': 'ğŸ”¥', 'gÃ¶zlÃ¼k': 'ğŸ‘“', 'gÃ¶zlÃ¼ÄŸÃ¼n': 'ğŸ‘“', 'yaÄŸ': 'ğŸ§ˆ', 'yaÄŸÄ±n': 'ğŸ§ˆ',
            'halÄ±': 'ğŸ§º', 'halÄ±nÄ±n': 'ğŸ§º', 'Ä±ÅŸÄ±k': 'ğŸ’¡', 'Ä±ÅŸÄ±ÄŸÄ±n': 'ğŸ’¡', 'iÄŸne': 'ğŸª¡', 'iÄŸnenin': 'ğŸª¡',
            'jilet': 'ğŸª’', 'jiletÄ±n': 'ğŸª’', 'kapÄ±': 'ğŸšª', 'kapÄ±nÄ±n': 'ğŸšª', 'lamba': 'ğŸ•¯ï¸', 'lambanÄ±n': 'ğŸ•¯ï¸',
            'masa': 'ğŸª‘', 'masanÄ±n': 'ğŸª‘', 'niÅŸasta': 'ğŸ§º', 'niÅŸastanÄ±n': 'ğŸ§º', 'oda': 'ğŸšª', 'odanÄ±n': 'ğŸšª',
            'Ã¶rtÃ¼': 'ğŸ§£', 'Ã¶rtÃ¼nÃ¼n': 'ğŸ§£', 'perde': 'ğŸªŸ', 'perdenin': 'ğŸªŸ', 'raf': 'ğŸ“š', 'rafÄ±n': 'ğŸ“š',
            'sandalye': 'ğŸª‘', 'sandalyenin': 'ğŸª‘', 'ÅŸemsiye': 'â˜‚ï¸', 'ÅŸemsiyenin': 'â˜‚ï¸', 'tabak': 'ğŸ½ï¸', 'tabaÄŸÄ±n': 'ğŸ½ï¸',
            'Ã¼tÃ¼': 'ğŸ”Œ', 'Ã¼tÃ¼nÃ¼n': 'ğŸ”Œ', 'vazo': 'ğŸº', 'vazonun': 'ğŸº', 'yastÄ±k': 'ğŸ›ï¸', 'yastÄ±ÄŸÄ±n': 'ğŸ›ï¸',
            'zil': 'ğŸ””', 'zilin': 'ğŸ””', 'kaÅŸÄ±k': 'ğŸ¥„', 'kaÅŸÄ±ÄŸÄ±n': 'ğŸ¥„', 'bÄ±Ã§ak': 'ğŸ”ª', 'bÄ±Ã§aÄŸÄ±n': 'ğŸ”ª',
            
            // DiÄŸer
            'anne': 'ğŸ‘©', 'annenin': 'ğŸ‘©', 'baba': 'ğŸ‘¨', 'babanÄ±n': 'ğŸ‘¨', 'Ã§iÃ§ek': 'ğŸŒ¸', 'Ã§iÃ§eÄŸin': 'ğŸŒ¸',
            'dede': 'ğŸ‘´', 'dedenin': 'ğŸ‘´', 'ev': 'ğŸ ', 'evin': 'ğŸ ', 'fÄ±stÄ±k': 'ğŸ¥œ', 'fÄ±stÄ±ÄŸÄ±n': 'ğŸ¥œ',
            'gÃ¼neÅŸ': 'â˜€ï¸', 'gÃ¼neÅŸin': 'â˜€ï¸', 'daÄŸ': 'â›°ï¸', 'daÄŸÄ±n': 'â›°ï¸', 'hala': 'ğŸ‘©â€ğŸ¦°', 'halanÄ±n': 'ğŸ‘©â€ğŸ¦°',
            'Ä±rmak': 'ğŸï¸', 'Ä±rmaÄŸÄ±n': 'ğŸï¸', 'iplik': 'ğŸ§µ', 'ipliÄŸin': 'ğŸ§µ', 'jimnastik': 'ğŸ¤¸', 'jimnastiÄŸin': 'ğŸ¤¸',
            'kalem': 'âœï¸', 'kalemin': 'âœï¸', 'meyve': 'ğŸ', 'meyvenin': 'ğŸ', 'nene': 'ğŸ‘µ', 'nenenin': 'ğŸ‘µ',
            'ok': 'ğŸ¹', 'okumun': 'ğŸ¹', 'Ã¶ÄŸretmen': 'ğŸ‘¨â€ğŸ«', 'Ã¶ÄŸretmenin': 'ğŸ‘¨â€ğŸ«', 'pasta': 'ğŸ°', 'pastanÄ±n': 'ğŸ°',
            'resim': 'ğŸ¨', 'resminin': 'ğŸ¨', 'saat': 'â°', 'saatin': 'â°', 'ÅŸapka': 'ğŸ©', 'ÅŸapkanÄ±n': 'ğŸ©',
            'top': 'âš½', 'topun': 'âš½', 'uÃ§ak': 'âœˆï¸', 'uÃ§aÄŸÄ±n': 'âœˆï¸', 'zeytin': 'ğŸ«’', 'zeytinin': 'ğŸ«’'
        };

        // Prompt'tan emoji Ã§Ä±kar
        function getEmojiFromPrompt(prompt) {
            // Prompt'u kÃ¼Ã§Ã¼k harfe Ã§evir
            const lowerPrompt = prompt.toLowerCase();
            
            // Ã–nce tam kelime eÅŸleÅŸmesi ara
            const words = lowerPrompt.split(' ');
            for (let word of words) {
                // Noktalama iÅŸaretlerini temizle
                word = word.replace(/[.,!?;:'"]/g, '');
                if (WORD_TO_EMOJI[word]) {
                    return WORD_TO_EMOJI[word];
                }
            }
            
            // EÄŸer tam eÅŸleÅŸme yoksa, kÄ±smi eÅŸleÅŸme ara
            for (let key in WORD_TO_EMOJI) {
                if (lowerPrompt.includes(key)) {
                    return WORD_TO_EMOJI[key];
                }
            }
            
            return null;
        }

        // Global state
        let currentTheme = 'alfabe';
        let customPrompts = {}; // Tema bazlÄ±: { alfabe: { A: 'prompt' }, ciftlik: { A: 'prompt' } }
        let speechRate = 0.75; // Daha yavaÅŸ (Ã§ocuklar iÃ§in)
        let speechPitch = 1.5; // Daha tatlÄ±/yÃ¼ksek ses
        let selectedVoice = null;
        let voices = [];
        let apiKey = '';
        let ttsEngine = 'browser';
        let googleVoice = 'tr-TR-Wavenet-A';
        let audioCache = {};
        let totalUsage = 0;
        let maxLimit = 90;
        let unlimitedUsage = false;
        let letterClickCount = {}; // Her harf iÃ§in tÄ±klama sayacÄ±
        let fixedPrompts = {}; // Sabit tutulan harfler: { alfabe: { A: true } }

        // Initialize
        function init() {
            loadSettings();
            loadVoices();
            renderLetterGrid();
            renderPromptsGrid();
            updateUsageStats();
        }

        // Load voices
        function loadVoices() {
            voices = speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');
            voiceSelect.innerHTML = '<option value="">VarsayÄ±lan</option>';
            
            const turkishVoices = voices.filter(v => v.lang.startsWith('tr'));
            turkishVoices.forEach(voice => {
                const option = document.createElement('option');
                option.value = voice.name;
                // KadÄ±n seslerini vurgula
                const isFemale = voice.name.toLowerCase().includes('female') || 
                                 voice.name.toLowerCase().includes('kadÄ±n') ||
                                 voice.name.toLowerCase().includes('woman');
                option.textContent = voice.name + (isFemale ? ' ğŸ‘§ (Ã–nerilen)' : '');
                voiceSelect.appendChild(option);
            });

            const savedVoice = localStorage.getItem('huma_voice');
            if (savedVoice) {
                voiceSelect.value = savedVoice;
                selectedVoice = voices.find(v => v.name === savedVoice);
            } else {
                // Otomatik kadÄ±n sesi seÃ§
                const femaleVoice = turkishVoices.find(v => 
                    v.name.toLowerCase().includes('female') || 
                    v.name.toLowerCase().includes('kadÄ±n')
                );
                if (femaleVoice) {
                    selectedVoice = femaleVoice;
                    voiceSelect.value = femaleVoice.name;
                }
            }
        }

        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }

        // Load settings
        function loadSettings() {
            const savedTheme = localStorage.getItem('huma_theme');
            if (savedTheme) {
                currentTheme = savedTheme;
                document.getElementById('themeSelect').value = savedTheme;
            }

            const savedPrompts = localStorage.getItem('huma_prompts');
            if (savedPrompts) {
                try {
                    customPrompts = JSON.parse(savedPrompts);
                    // Eski format uyumluluÄŸu (dÃ¼z obje ise tema bazlÄ± yap)
                    if (customPrompts && !customPrompts.alfabe && !customPrompts.ciftlik && !customPrompts.ev) {
                        const oldPrompts = {...customPrompts};
                        customPrompts = { alfabe: oldPrompts, ciftlik: {}, ev: {} };
                    }
                } catch (e) {
                    customPrompts = { alfabe: {}, ciftlik: {}, ev: {} };
                }
            } else {
                customPrompts = { alfabe: {}, ciftlik: {}, ev: {} };
            }

            const savedFixed = localStorage.getItem('huma_fixed_prompts');
            if (savedFixed) {
                try {
                    fixedPrompts = JSON.parse(savedFixed);
                } catch (e) {
                    fixedPrompts = { alfabe: {}, ciftlik: {}, ev: {} };
                }
            } else {
                fixedPrompts = { alfabe: {}, ciftlik: {}, ev: {} };
            }

            const savedRate = localStorage.getItem('huma_rate');
            if (savedRate) {
                speechRate = parseFloat(savedRate);
            } else {
                speechRate = 0.75; // VarsayÄ±lan: yavaÅŸ (Ã§ocuklar iÃ§in)
            }
            document.getElementById('speechRate').value = speechRate;
            document.getElementById('rateValue').textContent = speechRate;

            const savedPitch = localStorage.getItem('huma_pitch');
            if (savedPitch) {
                speechPitch = parseFloat(savedPitch);
            } else {
                speechPitch = 1.5; // VarsayÄ±lan: tatlÄ±/yÃ¼ksek ses
            }
            document.getElementById('speechPitch').value = speechPitch;
            document.getElementById('pitchValue').textContent = speechPitch;

            const savedApiKey = localStorage.getItem('huma_apikey');
            if (savedApiKey) {
                apiKey = savedApiKey;
                document.getElementById('apiKey').value = savedApiKey;
            }

            const savedEngine = localStorage.getItem('huma_engine');
            if (savedEngine) {
                ttsEngine = savedEngine;
                document.getElementById('ttsEngine').value = savedEngine;
                updateEngineUI();
            }

            const savedGoogleVoice = localStorage.getItem('huma_google_voice');
            if (savedGoogleVoice) {
                googleVoice = savedGoogleVoice;
                document.getElementById('googleVoiceSelect').value = savedGoogleVoice;
            }

            const savedUsage = localStorage.getItem('huma_total_usage');
            if (savedUsage) {
                totalUsage = parseInt(savedUsage);
            }

            const savedLimit = localStorage.getItem('huma_max_limit');
            if (savedLimit) {
                maxLimit = parseInt(savedLimit);
                document.getElementById('maxLimit').value = maxLimit;
            }

            const savedUnlimited = localStorage.getItem('huma_unlimited');
            if (savedUnlimited === 'true') {
                unlimitedUsage = true;
                document.getElementById('unlimitedUsage').checked = true;
                document.getElementById('limitGroup').style.display = 'none';
            }

            const savedCache = localStorage.getItem('huma_audio_cache');
            if (savedCache) {
                try {
                    audioCache = JSON.parse(savedCache);
                } catch (e) {
                    audioCache = {};
                }
            }

            // Update cache count
            document.getElementById('cacheCount').textContent = Object.keys(audioCache).length;
        }

        // Update usage stats
        function updateUsageStats() {
            document.getElementById('totalUsage').textContent = totalUsage;
            document.getElementById('currentLimit').textContent = maxLimit;
            const remaining = unlimitedUsage ? 'âˆ' : Math.max(0, maxLimit - totalUsage);
            document.getElementById('remainingQuota').textContent = remaining;
            document.getElementById('cacheCount').textContent = Object.keys(audioCache).length;
        }

        // Toggle unlimited
        function toggleUnlimited() {
            unlimitedUsage = document.getElementById('unlimitedUsage').checked;
            localStorage.setItem('huma_unlimited', unlimitedUsage);
            document.getElementById('limitGroup').style.display = unlimitedUsage ? 'none' : 'block';
            updateUsageStats();
        }

        // Save limit
        function saveLimit() {
            maxLimit = parseInt(document.getElementById('maxLimit').value);
            localStorage.setItem('huma_max_limit', maxLimit);
            updateUsageStats();
        }

        // Update engine UI
        function updateEngineUI() {
            const googleGroup = document.getElementById('googleVoiceGroup');
            const browserGroup = document.getElementById('browserVoiceGroup');
            
            if (ttsEngine === 'google') {
                googleGroup.style.display = 'block';
                browserGroup.style.display = 'none';
            } else {
                googleGroup.style.display = 'none';
                browserGroup.style.display = 'block';
            }
        }

        // Save API key
        function saveApiKey() {
            apiKey = document.getElementById('apiKey').value.trim();
            localStorage.setItem('huma_apikey', apiKey);
            if (apiKey) {
                alert('âœ… API Key kaydedildi!');
            }
        }

        // Save TTS engine
        function saveTtsEngine() {
            ttsEngine = document.getElementById('ttsEngine').value;
            localStorage.setItem('huma_engine', ttsEngine);
            updateEngineUI();
        }

        // Save Google voice
        function saveGoogleVoice() {
            googleVoice = document.getElementById('googleVoiceSelect').value;
            localStorage.setItem('huma_google_voice', googleVoice);
        }

        // Render letter grid
        function renderLetterGrid() {
            const grid = document.getElementById('letterGrid');
            grid.innerHTML = '';

            TURKISH_LETTERS.forEach(letter => {
                const card = document.createElement('button');
                card.className = 'letter-card';
                card.setAttribute('data-letter', letter);
                
                // Tema bazlÄ± prompt al
                const themePrompts = customPrompts[currentTheme] || {};
                const prompt = themePrompts[letter] || THEMES[currentTheme][letter];
                let icon = getEmojiFromPrompt(prompt);
                
                // EÄŸer prompt'tan emoji bulunamazsa, tema varsayÄ±lanÄ±nÄ± kullan
                if (!icon) {
                    icon = THEME_IMAGES[currentTheme][letter] || 'â“';
                }
                
                card.innerHTML = `
                    <div class="letter-display">
                        <div class="letter-uppercase">${letter}</div>
                        <div class="letter-lowercase">${LOWERCASE[letter]}</div>
                    </div>
                    <div class="letter-icon">
                        <div>${icon}</div>
                    </div>
                `;
                card.onclick = () => playLetter(letter, card);
                grid.appendChild(card);
            });
        }

        // Play letter
        async function playLetter(letter, card) {
            // Animate
            card.classList.add('animate-bounce');
            setTimeout(() => card.classList.remove('animate-bounce'), 600);

            // Get prompt
            let prompt;
            const themePrompts = customPrompts[currentTheme] || {};
            const isFixed = fixedPrompts[currentTheme] && fixedPrompts[currentTheme][letter];
            
            if (themePrompts[letter] && isFixed) {
                // Sabit prompt varsa sadece onu kullan
                prompt = themePrompts[letter];
            } else {
                // DÃ¶ngÃ¼sel Ã¶rnekler: tema varsayÄ±lanlarÄ± arasÄ±nda dÃ¶n
                if (!letterClickCount[currentTheme]) {
                    letterClickCount[currentTheme] = {};
                }
                if (!letterClickCount[currentTheme][letter]) {
                    letterClickCount[currentTheme][letter] = 0;
                }
                
                // Tema iÃ§in tÃ¼m prompt varyasyonlarÄ±nÄ± al
                const allPrompts = getAllPromptsForLetter(letter);
                const index = letterClickCount[currentTheme][letter] % allPrompts.length;
                prompt = allPrompts[index];
                
                // SayacÄ± artÄ±r
                letterClickCount[currentTheme][letter]++;
            }

            // Emoji'yi gÃ¼ncelle
            updateCardEmoji(card, prompt);

            // Speak based on engine
            if (ttsEngine === 'google' && apiKey) {
                await speakWithGoogle(prompt);
            } else {
                speakWithBrowser(prompt);
            }
        }

        // KartÄ±n emojisini gÃ¼ncelle
        function updateCardEmoji(card, prompt) {
            const iconDiv = card.querySelector('.letter-icon div');
            if (iconDiv) {
                let emoji = getEmojiFromPrompt(prompt);
                if (!emoji) {
                    // Prompt'tan bulunamazsa tema varsayÄ±lanÄ±nÄ± kullan
                    const letter = card.getAttribute('data-letter') || card.querySelector('.letter-uppercase').textContent;
                    emoji = THEME_IMAGES[currentTheme][letter] || 'â“';
                }
                iconDiv.textContent = emoji;
            }
        }

        // Harf iÃ§in tÃ¼m prompt varyasyonlarÄ±nÄ± getir
        function getAllPromptsForLetter(letter) {
            const prompts = [];
            const themePrompts = customPrompts[currentTheme] || {};
            
            // Ã–zel prompt varsa ekle
            if (themePrompts[letter]) {
                prompts.push(themePrompts[letter]);
            }
            
            // Tema varsayÄ±lanÄ±nÄ± ekle
            if (THEMES[currentTheme][letter]) {
                prompts.push(THEMES[currentTheme][letter]);
            }
            
            // EÄŸer hiÃ§ prompt yoksa, sadece harfi sÃ¶yle
            if (prompts.length === 0) {
                prompts.push(`${letter} harfi`);
            }
            
            return prompts;
        }

        // Speak with browser
        function speakWithBrowser(text) {
            speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'tr-TR';
            utterance.rate = speechRate;
            utterance.pitch = speechPitch;
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }
            speechSynthesis.speak(utterance);
        }

        // Speak with Google TTS
        async function speakWithGoogle(text) {
            try {
                // Check API key
                if (!apiKey) {
                    alert('âš ï¸ Google TTS kullanmak iÃ§in API key girmeniz gerekiyor!');
                    speakWithBrowser(text);
                    return;
                }

                // Check cache
                const cacheKey = `${text}_${googleVoice}_${speechRate}_${speechPitch}`;
                if (audioCache[cacheKey]) {
                    playAudioData(audioCache[cacheKey]);
                    updateUsageStats();
                    return;
                }

                // Check limit (sessizce atla, popup gÃ¶sterme)
                if (!unlimitedUsage && totalUsage >= maxLimit) {
                    console.log('âš ï¸ KullanÄ±m limitine ulaÅŸÄ±ldÄ±, tarayÄ±cÄ± sesine geÃ§iliyor');
                    speakWithBrowser(text);
                    return;
                }

                // Call Google TTS API
                const response = await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        input: { text: text },
                        voice: {
                            languageCode: 'tr-TR',
                            name: googleVoice
                        },
                        audioConfig: {
                            audioEncoding: 'MP3',
                            speakingRate: speechRate,
                            pitch: (speechPitch - 1) * 20 // Convert to semitones
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('Google TTS API error');
                }

                const data = await response.json();
                const audioContent = data.audioContent;

                // Update usage
                totalUsage += text.length;
                localStorage.setItem('huma_total_usage', totalUsage);

                // Cache audio
                audioCache[cacheKey] = audioContent;
                localStorage.setItem('huma_audio_cache', JSON.stringify(audioCache));

                // Play audio
                playAudioData(audioContent);
                updateUsageStats();
            } catch (error) {
                console.error('Google TTS error:', error);
                alert('âŒ Google TTS hatasÄ±! TarayÄ±cÄ± sesine geÃ§iliyor...');
                // Fallback to browser TTS
                speakWithBrowser(text);
            }
        }

        // Play audio data
        function playAudioData(base64Audio) {
            const audio = new Audio('data:audio/mp3;base64,' + base64Audio);
            audio.play();
        }

        // Change theme
        function changeTheme() {
            currentTheme = document.getElementById('themeSelect').value;
            localStorage.setItem('huma_theme', currentTheme);
            renderLetterGrid(); // Re-render grid with new theme images
            renderPromptsGrid();
        }

        // Save voice
        function saveVoice() {
            const voiceName = document.getElementById('voiceSelect').value;
            localStorage.setItem('huma_voice', voiceName);
            selectedVoice = voices.find(v => v.name === voiceName);
        }

        // Update rate
        function updateRate(value) {
            speechRate = parseFloat(value);
            document.getElementById('rateValue').textContent = value;
            localStorage.setItem('huma_rate', value);
        }

        // Update pitch
        function updatePitch(value) {
            speechPitch = parseFloat(value);
            document.getElementById('pitchValue').textContent = value;
            localStorage.setItem('huma_pitch', value);
        }

        // Test voice with specific settings
        function testVoice(rate, pitch) {
            // GeÃ§ici olarak ayarlarÄ± deÄŸiÅŸtir
            const originalRate = speechRate;
            const originalPitch = speechPitch;
            
            speechRate = rate;
            speechPitch = pitch;
            
            // Slider'larÄ± gÃ¼ncelle
            document.getElementById('speechRate').value = rate;
            document.getElementById('rateValue').textContent = rate;
            document.getElementById('speechPitch').value = pitch;
            document.getElementById('pitchValue').textContent = pitch;
            
            // Test metni oku
            const testText = "Merhaba! Ben HUMA. A harfi Annenin A'sÄ±. Ä° harfi Ä°neÄŸin Ä°'si.";
            
            if (ttsEngine === 'google' && apiKey) {
                speakWithGoogle(testText);
            } else {
                speakWithBrowser(testText);
            }
            
            // KullanÄ±cÄ±ya bilgi ver
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = 'â–¶ï¸ Ã‡alÄ±yor...';
            btn.disabled = true;
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 5000);
        }

        // Set child-friendly voice settings
        function setChildFriendlyVoice() {
            speechRate = 0.75;
            speechPitch = 1.5;
            
            document.getElementById('speechRate').value = speechRate;
            document.getElementById('rateValue').textContent = speechRate;
            document.getElementById('speechPitch').value = speechPitch;
            document.getElementById('pitchValue').textContent = speechPitch;
            
            localStorage.setItem('huma_rate', speechRate);
            localStorage.setItem('huma_pitch', speechPitch);
            
            alert('âœ… Ã‡ocuk dostu ses ayarlarÄ± uygulandÄ±!\nğŸ¢ HÄ±z: YavaÅŸ (0.75)\nğŸ¤ Ton: TatlÄ± (1.5)');
        }

        // Render prompts grid
        function renderPromptsGrid() {
            const grid = document.getElementById('promptsGrid');
            grid.innerHTML = '';

            TURKISH_LETTERS.forEach(letter => {
                const group = document.createElement('div');
                group.className = 'prompt-group';
                
                const themePrompts = customPrompts[currentTheme] || {};
                const themeFixed = fixedPrompts[currentTheme] || {};
                const customPrompt = themePrompts[letter] || '';
                const isFixed = themeFixed[letter] || false;
                
                if (customPrompt) {
                    group.classList.add('has-custom');
                }

                const defaultPrompt = THEMES[currentTheme][letter];

                group.innerHTML = `
                    <label>${letter}</label>
                    <input type="text" 
                           data-letter="${letter}" 
                           value="${customPrompt}"
                           placeholder="${defaultPrompt}"
                           onblur="savePrompt('${letter}', this.value)"
                           oninput="updatePromptUI('${letter}', this.value)">
                    <div style="display: flex; gap: 5px; margin-top: 5px;">
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 0.85rem; cursor: pointer;">
                            <input type="checkbox" 
                                   data-letter="${letter}"
                                   ${isFixed ? 'checked' : ''}
                                   onchange="toggleFixed('${letter}', this.checked)"
                                   ${!customPrompt ? 'disabled' : ''}>
                            ğŸ“Œ Sabit Tut
                        </label>
                        <button class="reset-btn" 
                                onclick="resetPrompt('${letter}')"
                                style="position: static; margin: 0;"
                                ${!customPrompt ? 'disabled' : ''}>â†º</button>
                    </div>
                `;
                grid.appendChild(group);
            });
        }

        // Save prompt (tema bazlÄ±)
        function savePrompt(letter, value) {
            value = value.trim();
            if (!customPrompts[currentTheme]) {
                customPrompts[currentTheme] = {};
            }
            
            if (value) {
                customPrompts[currentTheme][letter] = value;
            } else {
                delete customPrompts[currentTheme][letter];
                // Prompt silindiÄŸinde sabit tut'u da kaldÄ±r
                if (fixedPrompts[currentTheme]) {
                    delete fixedPrompts[currentTheme][letter];
                }
            }
            
            localStorage.setItem('huma_prompts', JSON.stringify(customPrompts));
            localStorage.setItem('huma_fixed_prompts', JSON.stringify(fixedPrompts));
            renderLetterGrid(); // Re-render to update emoji
        }

        // Toggle fixed prompt
        function toggleFixed(letter, isFixed) {
            if (!fixedPrompts[currentTheme]) {
                fixedPrompts[currentTheme] = {};
            }
            
            if (isFixed) {
                fixedPrompts[currentTheme][letter] = true;
            } else {
                delete fixedPrompts[currentTheme][letter];
            }
            
            localStorage.setItem('huma_fixed_prompts', JSON.stringify(fixedPrompts));
        }

        // Update prompt UI
        function updatePromptUI(letter, value) {
            const input = document.querySelector(`input[data-letter="${letter}"][type="text"]`);
            const group = input.closest('.prompt-group');
            const resetBtn = group.querySelector('.reset-btn');
            const checkbox = group.querySelector(`input[type="checkbox"][data-letter="${letter}"]`);

            if (value.trim()) {
                group.classList.add('has-custom');
                resetBtn.disabled = false;
                if (checkbox) checkbox.disabled = false;
            } else {
                group.classList.remove('has-custom');
                resetBtn.disabled = true;
                if (checkbox) {
                    checkbox.disabled = true;
                    checkbox.checked = false;
                }
            }
        }

        // Reset prompt
        function resetPrompt(letter) {
            if (customPrompts[currentTheme]) {
                delete customPrompts[currentTheme][letter];
            }
            if (fixedPrompts[currentTheme]) {
                delete fixedPrompts[currentTheme][letter];
            }
            
            localStorage.setItem('huma_prompts', JSON.stringify(customPrompts));
            localStorage.setItem('huma_fixed_prompts', JSON.stringify(fixedPrompts));
            
            const input = document.querySelector(`input[data-letter="${letter}"][type="text"]`);
            const group = input.closest('.prompt-group');
            const resetBtn = group.querySelector('.reset-btn');
            const checkbox = group.querySelector(`input[type="checkbox"][data-letter="${letter}"]`);
            
            input.value = '';
            group.classList.remove('has-custom');
            resetBtn.disabled = true;
            if (checkbox) {
                checkbox.disabled = true;
                checkbox.checked = false;
            }
            renderLetterGrid(); // Re-render to update emoji
        }

        // Modal functions
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        // Close modal on backdrop click
        document.getElementById('settingsModal').onclick = function(e) {
            if (e.target === this) {
                closeSettings();
            }
        };

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
